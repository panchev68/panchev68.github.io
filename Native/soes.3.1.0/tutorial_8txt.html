<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SOES: tutorial.txt File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SOES<span id="projectnumber">&#160;v3.1.0</span>
   </div>
   <div id="projectbrief">Simple Open Source EtherCAT Slave</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('tutorial_8txt.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle"><div class="title">tutorial.txt File Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="anchor" id="general"></a>
General</h1>
<p>The SOES is a library that provides the Micro Controller user application with the means to access the EtherCAT fieldbus communication environment:</p><ul>
<li>EtherCAT State Machine</li>
<li>Mailbox Interfaces</li>
<li>Protocols<ul>
<li>CoE</li>
<li>FoE + bootstrap template</li>
</ul>
</li>
</ul>
<p>Support for mailbox and protocols are typical examples when you need a slave stack to control the Application Layer of EtherCAT. The PDI used for such applications is either SPI or some Micro Controller Interface</p>
<p>The following sections show some basic examples on how to get the SOES up and running, as well as a lightweight example on howto design your slave. Since all code is local to the application or global variables, it is possible to tweak and optimize when possible.</p>
<p>Our target Application:</p><ul>
<li>Inputs 40bit<ul>
<li>One button 8bit</li>
<li>One encoder value 32bit</li>
</ul>
</li>
<li>Outputs 8bit<ul>
<li>LED 8bit</li>
</ul>
</li>
<li>Parameters<ul>
<li>Encoder settings</li>
</ul>
</li>
<li>Slave commands<ul>
<li>Reset counter</li>
</ul>
</li>
</ul>
<p>Now to translate and implement on top of SOES.</p>
<p>First look on the start up code. This example shows how to add a main function that will be called by startup code. In this example main's only purpose is to spawn two new tasks. One that executes SOES and one that control the ERROR LED. Some ESCs provided a pin for the RUN LED, some even for the ERROR LED, if it don't you can control them from the slave Micro Controller. We'll focus on the "soes" task.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   rprintp (<span class="stringliteral">&quot;SOES (Simple Open EtherCAT Slave)\nsoes test\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <span class="comment">/* task_spawn (&quot;led_run&quot;, led_error, 15, 512, NULL); /</span></div>
<div class="line"><span class="comment">   task_spawn (&quot;led_error&quot;, led_error, 15, 512, NULL);</span></div>
<div class="line"><span class="comment">   task_spawn (&quot;soes&quot;, soes, 9, 1024, NULL);</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   return (0);</span></div>
<div class="line"><span class="comment">}</span></div>
</div><!-- fragment --><h1><a class="anchor" id="configuration"></a>
Configuration</h1>
<p>The function soes is our EtherCAT slave device and can be split in 3 parts. Hardware Init, Software Init and Application loop. We will start with the Hardware Init.</p>
<ul>
<li>Hardware Init<ul>
<li>esc_reset, special function used for ESC reset if no Physical EEPROM used. This is local to the Application not part of the generic ESC handling.</li>
<li>ESC_init, initialise SPI communication or similar</li>
<li>Wait for ESC is started, waiting for SPI to be up and running, we'll query the ESC register DL status if EEPROM loaded OK and PDI operational, eg. SPI OK.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> soes (<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">   TXPDOsize = SM3_sml = sizeTXPDO ();</div>
<div class="line">   RXPDOsize = SM2_sml = sizeRXPDO ();</div>
<div class="line"> </div>
<div class="line">   esc_reset ();</div>
<div class="line">   <a class="code hl_function" href="esc_8h.html#aa56f98409a38d1c4dc69ffb2b55296d5">ESC_init</a> ((<span class="keywordtype">void</span> *)spi_name);</div>
<div class="line"> </div>
<div class="line">   task_delay (tick_from_ms (200));</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// wait until ESC is started up</span></div>
<div class="line">   <span class="keywordflow">while</span> ((<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus &amp; 0x0001) == 0)</div>
<div class="line">   {</div>
<div class="line">      <a class="code hl_function" href="esc_8h.html#a75dc00eb2f8cedcc7440d77a890b93ce">ESC_read</a> (<a class="code hl_define" href="esc_8h.html#a7307fb7c3f7d54c7a44910f7100574cf">ESCREG_DLSTATUS</a>, (<span class="keywordtype">void</span> *) &amp;<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus,</div>
<div class="line">                sizeof (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus));</div>
<div class="line">      <a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus = etohs (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus);</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// reset ESC to init state</span></div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#a55117f304770586bf9627899ec5cb639">ESC_ALstatus</a> (<a class="code hl_define" href="esc_8h.html#abbfee5404d9c373b5dd4145d7468a17a">ESCinit</a>);</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="ttc" id="aecat__slv_8c_html_a3db9e3987914220c46278718e14e2ce6"><div class="ttname"><a href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a></div><div class="ttdeci">_ESCvar ESCvar</div><div class="ttdef"><b>Definition</b> ecat_slv.c:23</div></div>
<div class="ttc" id="aesc_8c_html_a55117f304770586bf9627899ec5cb639"><div class="ttname"><a href="esc_8c.html#a55117f304770586bf9627899ec5cb639">ESC_ALstatus</a></div><div class="ttdeci">void ESC_ALstatus(uint8_t status)</div><div class="ttdef"><b>Definition</b> esc.c:36</div></div>
<div class="ttc" id="aesc_8h_html_a7307fb7c3f7d54c7a44910f7100574cf"><div class="ttname"><a href="esc_8h.html#a7307fb7c3f7d54c7a44910f7100574cf">ESCREG_DLSTATUS</a></div><div class="ttdeci">#define ESCREG_DLSTATUS</div><div class="ttdef"><b>Definition</b> esc.h:21</div></div>
<div class="ttc" id="aesc_8h_html_a75dc00eb2f8cedcc7440d77a890b93ce"><div class="ttname"><a href="esc_8h.html#a75dc00eb2f8cedcc7440d77a890b93ce">ESC_read</a></div><div class="ttdeci">void ESC_read(uint16_t address, void *buf, uint16_t len)</div></div>
<div class="ttc" id="aesc_8h_html_aa56f98409a38d1c4dc69ffb2b55296d5"><div class="ttname"><a href="esc_8h.html#aa56f98409a38d1c4dc69ffb2b55296d5">ESC_init</a></div><div class="ttdeci">void ESC_init(const esc_cfg_t *cfg)</div></div>
<div class="ttc" id="aesc_8h_html_abbfee5404d9c373b5dd4145d7468a17a"><div class="ttname"><a href="esc_8h.html#abbfee5404d9c373b5dd4145d7468a17a">ESCinit</a></div><div class="ttdeci">#define ESCinit</div><div class="ttdef"><b>Definition</b> esc.h:72</div></div>
</div><!-- fragment --><ul>
<li>Software Init<ul>
<li>Reset the slave into Init state by writing AL Status register.</li>
<li>Clear Errors by writing AL Status Code register.</li>
<li>Stop the Application Layer, basically we disable the SyncManagers that implicitly block the data exchange.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> soes (<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">   <span class="keywordflow">while</span> ((<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus &amp; 0x0001) == 0)</div>
<div class="line">   {</div>
<div class="line">      <a class="code hl_function" href="esc_8h.html#a75dc00eb2f8cedcc7440d77a890b93ce">ESC_read</a> (<a class="code hl_define" href="esc_8h.html#a7307fb7c3f7d54c7a44910f7100574cf">ESCREG_DLSTATUS</a>, (<span class="keywordtype">void</span> *) &amp;<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus,</div>
<div class="line">                sizeof (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus));</div>
<div class="line">      <a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus = etohs (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.DLstatus);</div>
<div class="line">   }</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// reset ESC to init state</span></div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#a55117f304770586bf9627899ec5cb639">ESC_ALstatus</a> (<a class="code hl_define" href="esc_8h.html#abbfee5404d9c373b5dd4145d7468a17a">ESCinit</a>);</div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#a5c7d013280d00c551c34a1b4ba268c93">ESC_ALerror</a> (<a class="code hl_define" href="esc_8h.html#acd028c8cb5d08a99cc31bc2ee46c97fd">ALERR_NONE</a>);</div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#af114806603011938e35ae366d115d90f">ESC_stopmbx</a> ();</div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#a81ea48b9683662e8bed01fbb77826236">ESC_stopinput</a> ();</div>
<div class="line">   <a class="code hl_function" href="esc_8c.html#aea60761cf8862550e8901aa996069f8d">ESC_stopoutput</a> ();</div>
<div class="line"> </div>
<div class="line">   <span class="comment">// application run loop</span></div>
<div class="line">   <span class="keywordflow">while</span> (1)</div>
<div class="line">...</div>
<div class="line">}  </div>
<div class="ttc" id="aesc_8c_html_a5c7d013280d00c551c34a1b4ba268c93"><div class="ttname"><a href="esc_8c.html#a5c7d013280d00c551c34a1b4ba268c93">ESC_ALerror</a></div><div class="ttdeci">void ESC_ALerror(uint16_t errornumber)</div><div class="ttdef"><b>Definition</b> esc.c:23</div></div>
<div class="ttc" id="aesc_8c_html_a81ea48b9683662e8bed01fbb77826236"><div class="ttname"><a href="esc_8c.html#a81ea48b9683662e8bed01fbb77826236">ESC_stopinput</a></div><div class="ttdeci">void ESC_stopinput(void)</div><div class="ttdef"><b>Definition</b> esc.c:881</div></div>
<div class="ttc" id="aesc_8c_html_aea60761cf8862550e8901aa996069f8d"><div class="ttname"><a href="esc_8c.html#aea60761cf8862550e8901aa996069f8d">ESC_stopoutput</a></div><div class="ttdeci">void ESC_stopoutput(void)</div><div class="ttdef"><b>Definition</b> esc.c:924</div></div>
<div class="ttc" id="aesc_8c_html_af114806603011938e35ae366d115d90f"><div class="ttname"><a href="esc_8c.html#af114806603011938e35ae366d115d90f">ESC_stopmbx</a></div><div class="ttdeci">void ESC_stopmbx(void)</div><div class="ttdef"><b>Definition</b> esc.c:402</div></div>
<div class="ttc" id="aesc_8h_html_acd028c8cb5d08a99cc31bc2ee46c97fd"><div class="ttname"><a href="esc_8h.html#acd028c8cb5d08a99cc31bc2ee46c97fd">ALERR_NONE</a></div><div class="ttdeci">#define ALERR_NONE</div><div class="ttdef"><b>Definition</b> esc.h:105</div></div>
</div><!-- fragment --><ul>
<li>Application loop<ul>
<li>ALevent handling, ALevent hold information on changes in ALControl or SyncManagers. ALControl for state changes and SyncManagers for changes written by EtherCAT in local memory mapped to active SyncManagers</li>
<li>ESC_state for state handling, such as state step up or down with correct error and acknowledge response. <br  />
</li>
<li>Mailbox handler, generic support of mailboxes used by all Application Layer protocols.</li>
<li>On mailbox actions we'll also check if we need to use a specific protocol handler to handle the incoming or outgoing Mailbox data.</li>
</ul>
</li>
</ul>
<p>Up until the now we're using the SOES protocol stack without any application specific calls. Next up we'll look at the application Code, here named DIG_process ().</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> soes (<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">   <span class="comment">// application run loop</span></div>
<div class="line">   <span class="keywordflow">while</span> (1)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span>((<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.ALstatus &amp; 0x0f) == <a class="code hl_define" href="esc_8h.html#abbfee5404d9c373b5dd4145d7468a17a">ESCinit</a>)</div>
<div class="line">      {</div>
<div class="line">         txpdomap = DEFAULTTXPDOMAP;</div>
<div class="line">         rxpdomap = DEFAULTRXPDOMAP;</div>
<div class="line">         txpdoitems = DEFAULTTXPDOITEMS;</div>
<div class="line">         rxpdoitems = DEFAULTTXPDOITEMS;</div>
<div class="line">      }</div>
<div class="line">      <a class="code hl_function" href="esc_8h.html#a75dc00eb2f8cedcc7440d77a890b93ce">ESC_read</a> (<a class="code hl_define" href="esc_8h.html#a6da09b045593c131194d037cf180af6e">ESCREG_LOCALTIME</a>, (<span class="keywordtype">void</span> *) &amp;<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.Time, sizeof (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.Time));</div>
<div class="line">      <a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.Time = etohl (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.Time);</div>
<div class="line"> </div>
<div class="line">      <a class="code hl_function" href="esc_8c.html#a1f4da4aa96dc469b218abf33ff857130">ESC_state</a> ();</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code hl_function" href="esc_8c.html#ab610384ffda76f06ccaa6d6914df752e">ESC_mbxprocess</a> ())</div>
<div class="line">      {</div>
<div class="line">         <a class="code hl_function" href="esc__coe_8c.html#a71c76794b7e4ed125cc9cda0e8508ccd">ESC_coeprocess</a> ();</div>
<div class="line">         <a class="code hl_function" href="esc__foe_8c.html#a57ace265be44ccc2a0af313d007261b2">ESC_foeprocess</a> ();</div>
<div class="line">         <a class="code hl_function" href="esc_8c.html#aa783bb45ace470b98607ce7c4af0460f">ESC_xoeprocess</a> ();</div>
<div class="line">      }</div>
<div class="line">      <a class="code hl_function" href="ecat__slv_8c.html#a5e916cdc70d47e2df99f370dcdf40a6a">DIG_process</a> ();</div>
<div class="line">   };</div>
<div class="line">}</div>
<div class="ttc" id="aecat__slv_8c_html_a5e916cdc70d47e2df99f370dcdf40a6a"><div class="ttname"><a href="ecat__slv_8c.html#a5e916cdc70d47e2df99f370dcdf40a6a">DIG_process</a></div><div class="ttdeci">void DIG_process(uint8_t flags)</div><div class="ttdef"><b>Definition</b> ecat_slv.c:174</div></div>
<div class="ttc" id="aesc_8c_html_a1f4da4aa96dc469b218abf33ff857130"><div class="ttname"><a href="esc_8c.html#a1f4da4aa96dc469b218abf33ff857130">ESC_state</a></div><div class="ttdeci">void ESC_state(void)</div><div class="ttdef"><b>Definition</b> esc.c:1093</div></div>
<div class="ttc" id="aesc_8c_html_aa783bb45ace470b98607ce7c4af0460f"><div class="ttname"><a href="esc_8c.html#aa783bb45ace470b98607ce7c4af0460f">ESC_xoeprocess</a></div><div class="ttdeci">void ESC_xoeprocess(void)</div><div class="ttdef"><b>Definition</b> esc.c:681</div></div>
<div class="ttc" id="aesc_8c_html_ab610384ffda76f06ccaa6d6914df752e"><div class="ttname"><a href="esc_8c.html#ab610384ffda76f06ccaa6d6914df752e">ESC_mbxprocess</a></div><div class="ttdeci">uint8_t ESC_mbxprocess(void)</div><div class="ttdef"><b>Definition</b> esc.c:561</div></div>
<div class="ttc" id="aesc_8h_html_a6da09b045593c131194d037cf180af6e"><div class="ttname"><a href="esc_8h.html#a6da09b045593c131194d037cf180af6e">ESCREG_LOCALTIME</a></div><div class="ttdeci">#define ESCREG_LOCALTIME</div><div class="ttdef"><b>Definition</b> esc.h:51</div></div>
<div class="ttc" id="aesc__coe_8c_html_a71c76794b7e4ed125cc9cda0e8508ccd"><div class="ttname"><a href="esc__coe_8c.html#a71c76794b7e4ed125cc9cda0e8508ccd">ESC_coeprocess</a></div><div class="ttdeci">void ESC_coeprocess(void)</div><div class="ttdef"><b>Definition</b> esc_coe.c:1435</div></div>
<div class="ttc" id="aesc__foe_8c_html_a57ace265be44ccc2a0af313d007261b2"><div class="ttname"><a href="esc__foe_8c.html#a57ace265be44ccc2a0af313d007261b2">ESC_foeprocess</a></div><div class="ttdeci">void ESC_foeprocess(void)</div><div class="ttdef"><b>Definition</b> esc_foe.c:557</div></div>
</div><!-- fragment --><h1><a class="anchor" id="application"></a>
Application</h1>
<p>The function DIG_process is the User part of the application and could be joined by more cyclic User functions for executing other parts of the application. The example code can be split in 2 parts</p><ul>
<li>Outputs<ul>
<li>Start by evaluating if we're in a state supporting update of outputs, eg. Operational state.</li>
<li>If we're in OP we can read the current PDO data in the 3-buffer SyncManager mapped to the output SM, the default is SyncManager2, we read the ESC RAM address of SM2 and store it at the local address of the local variable Wb.LED. We'll read RXPDOsize bytes to trigger a complete SyncManager read.</li>
<li>After local variables have been refreshed we basically write the local PDO variables to the User application, ex. a GPIO.</li>
<li>Basically this is the API of the SOES toward the User Application.</li>
<li>This function also include a watchdog mechanism, if triggered it will shutdown the outputs and trigger a state changes to safe operational. AlError is updated with cause of error to inform the Master.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="ecat__slv_8c.html#a72f970a83a7bc1595c61782d423f8fe9">RXPDO_update</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <a class="code hl_function" href="esc_8h.html#a75dc00eb2f8cedcc7440d77a890b93ce">ESC_read</a> (<a class="code hl_define" href="options_8h.html#a17b011cd3b4d2c7aaa4d97a3f9140d9e">SM2_sma</a>, &amp;Wb.LED, RXPDOsize);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="ecat__slv_8c.html#a5e916cdc70d47e2df99f370dcdf40a6a">DIG_process</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">if</span> (App.state &amp; <a class="code hl_define" href="esc_8h.html#a3d333984965abbada72473e658b3bc8f">APPSTATE_OUTPUT</a>)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span> (<a class="code hl_variable" href="ecat__slv_8c.html#a3db9e3987914220c46278718e14e2ce6">ESCvar</a>.ALevent &amp; <a class="code hl_define" href="esc_8h.html#a7f4270f5e37d8e797a3033523e0f84d0">ESCREG_ALEVENT_SM2</a>)  <span class="comment">// SM2 trigger ?</span></div>
<div class="line">      {</div>
<div class="line">         <a class="code hl_function" href="ecat__slv_8c.html#a72f970a83a7bc1595c61782d423f8fe9">RXPDO_update</a> ();</div>
<div class="line">         reset_wd ();</div>
<div class="line">         gpio_set(GPIO_LED, Wb.LED &amp; BIT(0));</div>
<div class="line"> </div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (!wd_cnt)</div>
<div class="line">      {</div>
<div class="line">         <a class="code hl_function" href="esc_8c.html#aea60761cf8862550e8901aa996069f8d">ESC_stopoutput</a> ();</div>
<div class="line">         <span class="comment">// watchdog, invalid outputs</span></div>
<div class="line">         <a class="code hl_function" href="esc_8c.html#a5c7d013280d00c551c34a1b4ba268c93">ESC_ALerror</a> (<a class="code hl_define" href="esc_8h.html#af236abe4b811bcebfb6556e3ddd85a20">ALERR_WATCHDOG</a>);</div>
<div class="line">         <span class="comment">// goto safe-op with error bit set</span></div>
<div class="line">         <a class="code hl_function" href="esc_8c.html#a55117f304770586bf9627899ec5cb639">ESC_ALstatus</a> (<a class="code hl_define" href="esc_8h.html#a8badc20d57f274700ff6786013f4dba8">ESCsafeop</a> | <a class="code hl_define" href="esc_8h.html#abc139331f4812b302e34bb3709ff915b">ESCerror</a>);</div>
<div class="line">         wd_trigger = 1;</div>
<div class="line">      }</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">   {</div>
<div class="line">      reset_wd ();</div>
<div class="line">   }</div>
<div class="line">...</div>
<div class="line">}</div>
<div class="ttc" id="aecat__slv_8c_html_a72f970a83a7bc1595c61782d423f8fe9"><div class="ttname"><a href="ecat__slv_8c.html#a72f970a83a7bc1595c61782d423f8fe9">RXPDO_update</a></div><div class="ttdeci">void RXPDO_update(void)</div><div class="ttdef"><b>Definition</b> ecat_slv.c:150</div></div>
<div class="ttc" id="aesc_8h_html_a3d333984965abbada72473e658b3bc8f"><div class="ttname"><a href="esc_8h.html#a3d333984965abbada72473e658b3bc8f">APPSTATE_OUTPUT</a></div><div class="ttdeci">#define APPSTATE_OUTPUT</div><div class="ttdef"><b>Definition</b> esc.h:297</div></div>
<div class="ttc" id="aesc_8h_html_a7f4270f5e37d8e797a3033523e0f84d0"><div class="ttname"><a href="esc_8h.html#a7f4270f5e37d8e797a3033523e0f84d0">ESCREG_ALEVENT_SM2</a></div><div class="ttdeci">#define ESCREG_ALEVENT_SM2</div><div class="ttdef"><b>Definition</b> esc.h:39</div></div>
<div class="ttc" id="aesc_8h_html_a8badc20d57f274700ff6786013f4dba8"><div class="ttname"><a href="esc_8h.html#a8badc20d57f274700ff6786013f4dba8">ESCsafeop</a></div><div class="ttdeci">#define ESCsafeop</div><div class="ttdef"><b>Definition</b> esc.h:75</div></div>
<div class="ttc" id="aesc_8h_html_abc139331f4812b302e34bb3709ff915b"><div class="ttname"><a href="esc_8h.html#abc139331f4812b302e34bb3709ff915b">ESCerror</a></div><div class="ttdeci">#define ESCerror</div><div class="ttdef"><b>Definition</b> esc.h:77</div></div>
<div class="ttc" id="aesc_8h_html_af236abe4b811bcebfb6556e3ddd85a20"><div class="ttname"><a href="esc_8h.html#af236abe4b811bcebfb6556e3ddd85a20">ALERR_WATCHDOG</a></div><div class="ttdeci">#define ALERR_WATCHDOG</div><div class="ttdef"><b>Definition</b> esc.h:118</div></div>
<div class="ttc" id="aoptions_8h_html_a17b011cd3b4d2c7aaa4d97a3f9140d9e"><div class="ttname"><a href="options_8h.html#a17b011cd3b4d2c7aaa4d97a3f9140d9e">SM2_sma</a></div><div class="ttdeci">#define SM2_sma</div><div class="ttdef"><b>Definition</b> options.h:103</div></div>
</div><!-- fragment --><ul>
<li>Inputs<ul>
<li>Is handled a bit simpler than outputs but in reverse order, the slave will continue update the inputs in state Safe Operational.</li>
<li>Here we first read User application data from ex. GPIO and then write to local PDO variables.</li>
<li>After the local variables have been refreshed we write those to the current PDO data 3-buffer SyncManager mapped to the input SM, the default is SyncManager3. This way we update the ESC RAM address with User Application data accessed by the EtherCAT master.</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="ecat__slv_8c.html#a71b1d5022f0ce6ff436fdfdf0589d7b5">TXPDO_update</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <a class="code hl_function" href="esc_8h.html#a27cd242b7e69eefc3fa1aa5316c87be5">ESC_write</a> (<a class="code hl_define" href="options_8h.html#a115f471e25ada517dc92451cbf921416">SM3_sma</a>, &amp;Rb.button, TXPDOsize);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="ecat__slv_8c.html#a5e916cdc70d47e2df99f370dcdf40a6a">DIG_process</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">...</div>
<div class="line">   Rb.button = gpio_get(GPIO_WAKEUP);</div>
<div class="line">   Cb.reset_counter++;</div>
<div class="line">   Rb.encoder =  Cb.reset_counter;</div>
<div class="line"> </div>
<div class="line">   <a class="code hl_function" href="ecat__slv_8c.html#a71b1d5022f0ce6ff436fdfdf0589d7b5">TXPDO_update</a> ();</div>
<div class="line">}</div>
<div class="ttc" id="aecat__slv_8c_html_a71b1d5022f0ce6ff436fdfdf0589d7b5"><div class="ttname"><a href="ecat__slv_8c.html#a71b1d5022f0ce6ff436fdfdf0589d7b5">TXPDO_update</a></div><div class="ttdeci">void TXPDO_update(void)</div><div class="ttdef"><b>Definition</b> ecat_slv.c:137</div></div>
<div class="ttc" id="aesc_8h_html_a27cd242b7e69eefc3fa1aa5316c87be5"><div class="ttname"><a href="esc_8h.html#a27cd242b7e69eefc3fa1aa5316c87be5">ESC_write</a></div><div class="ttdeci">void ESC_write(uint16_t address, void *buf, uint16_t len)</div></div>
<div class="ttc" id="aoptions_8h_html_a115f471e25ada517dc92451cbf921416"><div class="ttname"><a href="options_8h.html#a115f471e25ada517dc92451cbf921416">SM3_sma</a></div><div class="ttdeci">#define SM3_sma</div><div class="ttdef"><b>Definition</b> options.h:115</div></div>
</div><!-- fragment --><h1><a class="anchor" id="ApplicationdataProcessdata"></a>
ApplicationdataProcessdata</h1>
<p>To run application data through EtherCAT processdata we need to describe for the fieldbus what data we have and will read/write. For this we have 3 objects, the ESI file, SII-EEPROM and CoE Object Dictionary. The first 2 are mandatory and the third is a very convenient way of describing complex slaves.</p>
<p>Our strategy is to keep the ESI file and the SII-EEPROM as thin as possible to avoid duplication of data that need to be maintained. Both will hold the bare minimum of mandatory + optional data to pass CTT. Optional data will be included to tell EtherCAT that detailed information can be retrieved via CoE from the OD stored in the slave it self.</p>
<h1><a class="anchor" id="SII-EEPROM"></a>
SII-EEPROM</h1>
<p>Snapshot from SII information matrix from EtherCAT communication slides.</p>
<div class="image">
<img src="sii_pdo.png" alt=""/>
<div class="caption">
Our target slave is Fixed PDO and OD</div></div>
 <h1><a class="anchor" id="ESI-file"></a>
ESI-file</h1>
<p>Snapshot from ESI tree from EtherCAT communication slides.</p>
<div class="image">
<img src="esi_pdo.png" alt=""/>
<div class="caption">
mandatory and optional ESI data</div></div>
 <p>To briefly give a hint what are describe in the ESI and SII we're listing a set of included elements marked M for mandatory and O for optional.</p>
<div class="fragment"><div class="line">- Vendor (M) , Describes the identity.</div>
<div class="line"> - Id (M), Hex, EtherCAT Vendor ID, OD 1018.01</div>
<div class="line"> - Name (M), NameType, Expedient vendor name</div>
<div class="line">- Descriptions (M), Describes the EtherCAT device(s) <span class="keyword">using </span>elements.</div>
<div class="line"> - Groups (M), Similar devices can be assigned to one group. </div>
<div class="line">  - Group (M), One group groups similar devices with slightly different features</div>
<div class="line">   - Type (M), A reference handle corresponding to the GroupType value in Description:Devices:Device:Group</div>
<div class="line">  - Name (M), Name <span class="keywordflow">for</span> <span class="keyword">this</span> group show by a configuration tool</div>
<div class="line"> - Devices (M), Element devices may describe one or several devices with their EtherCAT features such as SyncManagers, FMMUs and Dictionaries</div>
<div class="line">  - Device (O), Holds all information about the device like syncmanagers and FMMU, <span class="keywordtype">object</span> dictionary, data types and the PDO mapping and assign description</div>
<div class="line">  - Device ATT: Physics (M),string, Physics at individual ports</div>
<div class="line">   - Type (M), Device identity </div>
<div class="line">  - Type ATT:ProductCode=<span class="stringliteral">&quot;#x98123467&quot;</span> </div>
<div class="line">  - Type ATT:RevisionNo=<span class="stringliteral">&quot;#x00000001&quot;</span></div>
<div class="line">  - Name (M), Detailed name of device shown by a configuration tool (not used <span class="keywordflow">for</span> identification)</div>
<div class="line">   - GroupType (M), Reference to a group (described in element Groups) to which <span class="keyword">this</span> device should be assigned to. Name of the handle used in element Groups:Group:Type         </div>
<div class="line">   - Fmmu (O), String to describe function, Outputs -&gt; RxPDO, Inputs -&gt; TxPDO , MBoxState -&gt; FMMU is used to poll Input Mailbox</div>
<div class="line">  - Sm (O), Description of SyncManager including start address and direction. </div>
<div class="line">   - MBoxOut Mailbox Data Master -&gt; Slave</div>
<div class="line">   - MBoxIn Mailbox Data Slave -&gt; Master</div>
<div class="line">   - Outputs Process Data Master -&gt; Slave</div>
<div class="line">   - Inputs Process Data Slave -&gt; master  </div>
<div class="line">  - Sm ATT:DefaultSize=<span class="stringliteral">&quot;128&quot;</span> , Size</div>
<div class="line">  - Sm ATT:StartAddress=<span class="stringliteral">&quot;#x1000&quot;</span> , Start address</div>
<div class="line">  - Sm ATT:ControlByte=<span class="stringliteral">&quot;#x26&quot;</span> , Settings , Bit [1][0] = 10, Operation mode Mailbox, 00 Buffered 3.</div>
<div class="line">  - Sm ATT:Enable=<span class="stringliteral">&quot;1&quot;</span>, Enabled</div>
<div class="line">  - Mailbox (O), Description of available mailbox protocols</div>
<div class="line">  - Mailbox ATT: DataLinkLayer=<span class="stringliteral">&quot;true&quot;</span>, Support of Mailbox Data Link Layer is mandatory.</div>
<div class="line">   - CoE (O), Device support CoE</div>
<div class="line">   - CoE (O) ATT: SdoInfo=<span class="stringliteral">&quot;true&quot;</span> , SDO Information Service </div>
<div class="line">   - CoE (O) ATT: CompleteAccess=<span class="stringliteral">&quot;false&quot;</span> , SDO complete access not supported</div>
<div class="line">   - CoE (O) ATT: PdoUpload=<span class="stringliteral">&quot;true&quot;</span>, PDO description uploaded from the slave<span class="stringliteral">&#39;s object dictionary and SyncManager length calculated based on the same</span></div>
<div class="line"><span class="stringliteral">  - Dc (O), describes synchronization modes supported by the device.</span></div>
<div class="line"><span class="stringliteral">   - OpMode (O), Definition of supported operation  modes</span></div>
<div class="line"><span class="stringliteral">    - Name (M), Internal Handle of operation mode</span></div>
<div class="line"><span class="stringliteral">    - Desc (O(M)), description of operation mode, recommended, Free Run (no sync), SM Synchronous, DC Synchronous </span></div>
<div class="line"><span class="stringliteral">    - AssignActive (M), Value of Latch and Sync Control registers</span></div>
<div class="line"><span class="stringliteral">  - Eeprom (O, use is mandatory) </span></div>
<div class="line"><span class="stringliteral">   - Data (M)</span></div>
<div class="line"><span class="stringliteral">        Or</span></div>
<div class="line"><span class="stringliteral">   - ByteSize (M), Byte Size of connected EEPROM device</span></div>
<div class="line"><span class="stringliteral">   - ConfigData (M), First 7 words of EEPROM, Configuration Areas</span></div>
<div class="line"><span class="stringliteral">   - BootStrap (O), Start address and length of mailboxes for BootStrap</span></div>
</div><!-- fragment --><p>So to describe the application we use CoE and Object Dictionary. The mapping between Object Dictionary and the User Application are done via local variables defined as user types. The Object Dictionary itself is stored in a matrix where all the indexes are listed. Every index then have a submatrix with its subindex.</p>
<h1><a class="anchor" id="ObjectDictionary"></a>
ObjectDictionary</h1>
<p>The Object Dictionary used as example follow the CANopen DS301 ranges.</p>
<ul>
<li>0x0000 - 0x0FFF, Data Type Area</li>
<li>0x1000 - 0x1FFF, Communication Area</li>
<li>0x2000 - 0x5FFF, Manufacture specific area</li>
<li>0x6000 - 0x6FFF, Input area</li>
<li>0x7000 - 0x7FFF, Output area</li>
<li>0x8000 - 0x8FFF, Configuration area</li>
<li>0x9000 - 0x9FFF, Information area</li>
<li>0xA000 - 0xAFFF, Diagnosis Area</li>
<li>0xB000 - 0xBFFF, Service Transfer Area</li>
<li>0xC000 - 0xEFFF, Reserved Area</li>
<li>0xF000 - 0xFFFF, Device Area</li>
</ul>
<p>RxPDO , 0x1600 - 0x17FF TxPDO , 0x1A00 - 0x1BFF</p>
<p>Example, on how the the OD index are linked. Top index, SyncManagers Communication Types. In index 0 the 0x04 indicates we have 4 SyncManagers defined. Every SyncManager is assigned a type, in index 1-4, we have standard settings SM0 = 1, SM1 = 2, SM2 = 3, SM3 = 4 from ETG 1000.6, 5.6.7.4. <br  />
</p><ul>
<li>0, Unused</li>
<li>1, MailBox Receive, master to slave</li>
<li>2, MailBox Send, slave to master</li>
<li>3, Processdata output, master to slave</li>
<li>4, Processdata input, slave to master</li>
</ul>
<div class="fragment"><div class="line">objectlist.h</div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objectlist.html">_objectlist</a> <a class="code hl_variable" href="esc__coe_8h.html#a6f05428728936fdf9d9ce06d99fca3db">SDOobjects</a>[] =</div>
<div class="line">...</div>
<div class="line">  {0x1C00, <a class="code hl_define" href="esc__coe_8h.html#a20280d26fa694f0dcd9231d8175a4100">OTYPE_ARRAY</a>, 4, 0, &amp;acName1C00[0], &amp;SDO1C00[0]},</div>
<div class="line">  </div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objd.html">_objd</a> SDO1C00[] =</div>
<div class="line">{ {0x00, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acNameNOE[0], 0x04, nil},</div>
<div class="line">  {0x01, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acName1C00_01[0], 0x01, nil},</div>
<div class="line">  {0x02, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acName1C00_02[0], 0x02, nil},</div>
<div class="line">  {0x03, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acName1C00_03[0], 0x03, nil},</div>
<div class="line">  {0x04, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acName1C00_04[0], 0x04, nil}</div>
<div class="ttc" id="aesc__coe_8h_html_a20280d26fa694f0dcd9231d8175a4100"><div class="ttname"><a href="esc__coe_8h.html#a20280d26fa694f0dcd9231d8175a4100">OTYPE_ARRAY</a></div><div class="ttdeci">#define OTYPE_ARRAY</div><div class="ttdef"><b>Definition</b> esc_coe.h:54</div></div>
<div class="ttc" id="aesc__coe_8h_html_a6f05428728936fdf9d9ce06d99fca3db"><div class="ttname"><a href="esc__coe_8h.html#a6f05428728936fdf9d9ce06d99fca3db">SDOobjects</a></div><div class="ttdeci">const _objectlist SDOobjects[]</div></div>
<div class="ttc" id="aesc__coe_8h_html_afba4c867a9923391a0de1f0e40ebed26"><div class="ttname"><a href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a></div><div class="ttdeci">#define DTYPE_UNSIGNED8</div><div class="ttdef"><b>Definition</b> esc_coe.h:61</div></div>
<div class="ttc" id="astruct__objd_html"><div class="ttname"><a href="struct__objd.html">_objd</a></div><div class="ttdef"><b>Definition</b> esc_coe.h:18</div></div>
<div class="ttc" id="astruct__objectlist_html"><div class="ttname"><a href="struct__objectlist.html">_objectlist</a></div><div class="ttdef"><b>Definition</b> esc_coe.h:30</div></div>
</div><!-- fragment --><p>SyncManagers channels 0-31 are listed in SDO1C10-SDO1C2F. If we look at SyncManager channel 2, we see.</p>
<ul>
<li>Type 3, Processdata output, master to slave</li>
</ul>
<p>It got one RxPDO index 0x1600 connected, and the submatrix for 0x1600 link one PDO object index 0x7000 subindex 1. The output object 0x70000108 give you the index 0x7000, subindex 1 and PDO object length 1(byte).</p>
<div class="fragment"><div class="line">objectlist.h</div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objd.html">_objd</a> SDO1C12[] =</div>
<div class="line">{ {0x00, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acNameNOE[0], 0x01, nil},</div>
<div class="line">  {0x01, <a class="code hl_define" href="esc__coe_8h.html#a15d96f5408f427f56c931decf6cac9a3">DTYPE_UNSIGNED16</a>, 16, ATYPE_R, &amp;acNameMO[0], 0x1600, nil}</div>
<div class="line">};</div>
<div class="line">  </div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objd.html">_objd</a> SDO1600[] =</div>
<div class="line">{ {0x00, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acNameNOE[0], 0x01, nil},</div>
<div class="line">  {0x01, <a class="code hl_define" href="esc__coe_8h.html#a445b45e923444ea163a3305a135126d6">DTYPE_UNSIGNED32</a>, 32, ATYPE_R, &amp;acNameMO[0], 0x70000108, nil}</div>
<div class="line">};</div>
<div class="ttc" id="aesc__coe_8h_html_a15d96f5408f427f56c931decf6cac9a3"><div class="ttname"><a href="esc__coe_8h.html#a15d96f5408f427f56c931decf6cac9a3">DTYPE_UNSIGNED16</a></div><div class="ttdeci">#define DTYPE_UNSIGNED16</div><div class="ttdef"><b>Definition</b> esc_coe.h:62</div></div>
<div class="ttc" id="aesc__coe_8h_html_a445b45e923444ea163a3305a135126d6"><div class="ttname"><a href="esc__coe_8h.html#a445b45e923444ea163a3305a135126d6">DTYPE_UNSIGNED32</a></div><div class="ttdeci">#define DTYPE_UNSIGNED32</div><div class="ttdef"><b>Definition</b> esc_coe.h:63</div></div>
</div><!-- fragment --><p>At PDO level we make the connection between the local application and the object dictionary. For all subindex in the PDO the last element is the address to the local variable.</p>
<div class="fragment"><div class="line">objectlist.h</div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objd.html">_objd</a> SDO7000[] =</div>
<div class="line">{ {0x00, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acNameNOE[0], 0x01, nil},</div>
<div class="line">  {0x01, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, <a class="code hl_define" href="esc__coe_8h.html#a0bb908b7bb4765db3ab665dbbe922071">ATYPE_RW</a>, &amp;acName7000_01[0], 0, &amp;(Wb.LED)}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">utypes.h</div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">   uint8 LED;</div>
<div class="line">} _Wbuffer;</div>
<div class="ttc" id="aesc__coe_8h_html_a0bb908b7bb4765db3ab665dbbe922071"><div class="ttname"><a href="esc__coe_8h.html#a0bb908b7bb4765db3ab665dbbe922071">ATYPE_RW</a></div><div class="ttdeci">#define ATYPE_RW</div><div class="ttdef"><b>Definition</b> esc_coe.h:104</div></div>
</div><!-- fragment --><p>Beside SyncManager to PDO mapping we also have mandatory data as</p>
<p>0x1000 Device Type 0x1018 Object Identity 0x10C0 SyncManager Communication Type, as we used as top index when figuring out our PDOs in the Object Dictionary.</p>
<p>For a complete description of the object dictionary you can get guidance by the ETG1000.6 EcatAlProtocols</p>
<p>A useful feature is the Asynchronous use of SDO parameters. In the example we have Parameter set holding an encoder scale value, just for show we also have a read only mirror value of the encoder scale. Parameters defined as a RW SDO parameter and can be written/read by SDO Download or Upload. In addition there is a ESC_objecthandler Hook on SDO Download where you can add additional logic, ex. we execute the mirror of the encoder scale value by assigning the encoder scale value to the mirror.</p>
<div class="fragment"><div class="line">objectlist.h</div>
<div class="line">FLASHSTORE <a class="code hl_struct" href="struct__objd.html">_objd</a> SDO7100[] =</div>
<div class="line">{ {0x00, <a class="code hl_define" href="esc__coe_8h.html#afba4c867a9923391a0de1f0e40ebed26">DTYPE_UNSIGNED8</a>, 8, ATYPE_R, &amp;acNameNOE[0], 0x02, nil},</div>
<div class="line">  {0x01, <a class="code hl_define" href="esc__coe_8h.html#a445b45e923444ea163a3305a135126d6">DTYPE_UNSIGNED32</a>, 32, <a class="code hl_define" href="esc__coe_8h.html#a0bb908b7bb4765db3ab665dbbe922071">ATYPE_RW</a>, &amp;acName7100_01[0], 0, &amp;(encoder_scale)},</div>
<div class="line">  {0x02, <a class="code hl_define" href="esc__coe_8h.html#a445b45e923444ea163a3305a135126d6">DTYPE_UNSIGNED32</a>, 32, ATYPE_R, &amp;acName7100_02[0], 0, &amp;(encoder_scale_mirror)}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">soes.c</div>
<div class="line"><span class="keywordtype">void</span> ESC_objecthandler (uint16 index, uint8 subindex)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">switch</span> (index)</div>
<div class="line">   {</div>
<div class="line">...</div>
<div class="line">      <span class="keywordflow">case</span> 0x7100:</div>
<div class="line">      {</div>
<div class="line">         <span class="keywordflow">switch</span> (subindex)</div>
<div class="line">         {</div>
<div class="line">            <span class="keywordflow">case</span> 0x01:</div>
<div class="line">            {</div>
<div class="line">               encoder_scale_mirror = encoder_scale;</div>
<div class="line">               <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">         }</div>
<div class="line">         <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">...</div>
<div class="line">}</div>
</div><!-- fragment --><p> This tutorial is just one way of doing it. Enjoy and happy coding!</p>
<p>Andreas Karlsson, rt-labs AB, www.rt-labs.com </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorial_8txt.html">tutorial.txt</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
